{% extends "flood_monitoring_system/header.html" %}
{% load staticfiles%}

{% block header %}
<script src="{% static 'lib/canvasjs-2.2/canvasjs.min.js' %}"></script>
<script>
let marker_colours = {
    0:{
        "name":"blue",
        "hex":"#38AADD"
    },
    1:{
        "name":"green",
        "hex":"#72B026"
    },
    2:{
        "name":"orange",
        "hex":"#F69730"
    },
    3:{
        "name":"red",
        "hex":"#D63E2A"
    },
    4:{
        "name":"purple",
        "hex":"#D152B8"
    }
};

window.onload = function () {
CanvasJS.addColorSet("multicolor", [
    "#38AADD",
    "#72B026",
    "#F69730",
    "#D63E2A",
    "#D152B8"
]);
var chart = new CanvasJS.Chart("chartSensor", {
	animationEnabled: true,
	theme: "light2",
    colorSet:"multicolor",
	axisX:{
	    title: "Date and Time",
		valueFormatString: "DD MMM hh:mm TT",
		crosshair: {
			enabled: true,
			snapToDataPoint: true
		}
	},
	axisY: {
        title: "Water Level",
        suffix: "mm",
		crosshair: {
			enabled: true
		}
	},
	toolTip:{
		shared:true
	},
	legend:{
		cursor:"pointer",
		verticalAlign: "bottom",
		horizontalAlign: "left",
		dockInsidePlotArea: true,
		itemclick: toogleDataSeries
	},
    data: [
        {% for device in object_list.graph_data.results %}
            {
                type: "line",
                showInLegend: true,
                name: "{% if device.label %}{{ device.label }}{% elif device.location %}{{ device.location }}{% endif %}",
                markerType: "square",
                xValueType: "dateTime",
                xValueFormatString: "DD MMM hh:mm TT",
                dataPoints: [
                    {% for data in device.time_reading %}
                        {   x:{{data.0}}, y:{{ data.1 }}   },
                    {% endfor %}
                ]
            },
        {% endfor %}
    ]
});
chart.render();

function toogleDataSeries(e){
	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	} else{
		e.dataSeries.visible = true;
	}
	chart.render();
}

function filter_by_days_prior(days){
    tst = new Date()
    tst.setDate(tst.getDate() - days)
    console.log(tst.toString())

    chart.options.axisX.minimum = tst.getTime()
    console.log(chart.axisX.minimum)
    chart.render()
}
document.getElementById("filter1").addEventListener("click", function() {
    filter_by_days_prior(1)
}, false);

document.getElementById("filter7").addEventListener("click", function() {
    filter_by_days_prior(7)
}, false);

document.getElementById("filter30").addEventListener("click", function() {
    filter_by_days_prior(30)
}, false);
}
</script>
{% endblock %}

{% block maintitle %}Live Stats{% endblock %}

{% block maincontent %}
<div class="row">
    <div class="col-md-12">
       <section class="panel">
           <header class="panel-heading">
                <div class="row">
                   <div class="col-md-6">
                        <h2 class="panel-title">Water levels in the river Stour</h2>
                   </div>
                   <div class="col-md-6 text-right">
                       <button id="filter1" type="button" class="btn sm">1 day</button>
                       <button id="filter7" type="button" class="btn sm">7 days</button>
                       <button id="filter30" type="button" class="btn sm">30 days</button>
                   </div>
               </div>
           </header>
           <div class="panel-body">
                <div id="chartSensor" style="height: 400px; width: 100%;"></div>
           </div>
       </section>
   </div>
    <div class="col-md-6">
        <section class="panel">
           <header class="panel-heading">
               <div class="panel-actions">
                   <a href="#" class="fa fa-caret-down"></a>
               </div>
               <h2 class="panel-title">Live Map</h2>
               <p class="panel-subtitle">Water level data from all over Canterbury. Updates regularly.</p>
           </header>
           <div class="panel-body">
               {% include 'flood_monitoring_system/includes/map_view.html' %}
           </div>
       </section>
    </div>
    <div class="col-md-6">
        <section class="panel">
           <header class="panel-heading">
               <div class="panel-actions">
                   <a href="#" class="fa fa-caret-down"></a>
               </div>
               <h2 class="panel-title">Statistics</h2>
               <p class="panel-subtitle">Here's some interesting insights.</p>
           </header>
           <div class="panel-body">
               <div class="col-md-6">

               </div>
               <div class="col-md-6">
               </div>
               <div class="col-md-6">
               </div>
               <div class="col-md-6">
               </div>
               <div class="col-md-6">
               </div>
               <div class="col-md-6">
               </div>
           </div>
       </section>
    </div>
</div>
{% endblock %}

