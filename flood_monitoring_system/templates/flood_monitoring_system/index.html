{% extends "flood_monitoring_system/header.html" %}
{% load staticfiles%}

{% block header %}
<script src="{% static 'lib/canvasjs-2.2/canvasjs.min.js' %}"></script>
<script>


window.onload = function () {
CanvasJS.addColorSet("multicolor", [
    "#38AADD",
    "#72B026",
    "#F69730",
    "#D63E2A",
    "#D152B8",
    "#FF91EA",
    "#0067A3",
    "#000000",
]);
var chart = new CanvasJS.Chart("chartSensor", {
	animationEnabled: true,
	theme: "light2",
    colorSet:"multicolor",
	axisX:{
	    title: "Date and Time",
		valueFormatString: "DD MMM hh:mm TT",
		crosshair: {
			enabled: true,
			snapToDataPoint: true
		}
	},
	axisY: {
        title: "Water Level",
        suffix: "mm",
		crosshair: {
			enabled: true
		}
	},
	toolTip:{
		shared:true
	},
	legend:{
		cursor:"pointer",
		verticalAlign: "bottom",
		horizontalAlign: "left",
		dockInsidePlotArea: true,
		itemclick: toogleDataSeries
	},
    data: [
        {% for device in object_list.graph_data.results %}
            {
                type: "line",
                showInLegend: true,
                name: "{% if device.label %}{{ device.label }}{% elif device.location %}{{ device.location }}{% endif %}",
                markerType: "square",
                xValueType: "dateTime",
                xValueFormatString: "DD MMM hh:mm TT",
                dataPoints: [
                    {% for data in device.time_reading %}
                        {   x:{{data.0}}, y:{{ data.1 }}   },
                    {% endfor %}
                ]
            },
        {% endfor %}
    ]
});
chart.render();

function toogleDataSeries(e){
	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	} else{
		e.dataSeries.visible = true;
	}
	chart.render();
}

function filter_all(){
    console.log(tst.toString())
    delete chart.options.axisX.minimum
    document.getElementById("filter_val").textContent = "show all time"
    //chart.options.axisX.minimum = tst.getTime()
    //console.log(chart.axisX.minimum)
    chart.render()
}

function filter_by_days_prior(days){
    tst = new Date()
    tst.setDate(tst.getDate() - days)
    console.log(tst.toString())
    if(days == 1){
        document.getElementById("filter_val").textContent = "show last day"
    }else{
        document.getElementById("filter_val").textContent = "show last " + days + " days"
    }
    chart.options.axisX.minimum = tst.getTime()
    console.log(chart.axisX.minimum)
    chart.render()
}
document.getElementById("filter1").addEventListener("click", function() {
    filter_by_days_prior(1)
}, false);

document.getElementById("filter7").addEventListener("click", function() {
    filter_by_days_prior(7)
}, false);

document.getElementById("filter30").addEventListener("click", function() {
    filter_by_days_prior(30)
}, false);
document.getElementById("filterall").addEventListener("click", function() {
    filter_all()
}, false);
}
</script>
{% endblock %}

{% block maintitle %}Live Stats{% endblock %}

{% block maincontent %}
<div class="row">
    <div class="col-md-12">
       <section class="panel">
           <header class="panel-heading">
                <div class="row">
                   <div class="col-md-6">
                        <h2 class="panel-title">Water levels in the river Stour</h2>
                       <h4 id="filter_val">show all time</h4>
                   </div>
                   <div class="col-md-6 text-right">
                       <button id="filter1" type="button" class="btn sm">1 day</button>
                       <button id="filter7" type="button" class="btn sm">7 days</button>
                       <button id="filter30" type="button" class="btn sm">30 days</button>
                       <button id="filterall" type="button" class="btn sm">all time</button>
                   </div>
               </div>
           </header>
           <div class="panel-body">
                <div id="chartSensor" style="height: 400px; width: 100%;"></div>
           </div>
       </section>
   </div>
    <div class="col-md-12">
        <section class="panel">
           <header class="panel-heading">
               <div class="panel-actions">
                   <a href="#" class="fa fa-caret-down"></a>
               </div>
               <h2 class="panel-title">Live Map</h2>
               <p class="panel-subtitle">Water level data from all over Canterbury. Updates regularly.</p>
           </header>
           <div class="panel-body">
               {% include 'flood_monitoring_system/includes/map_view.html' %}
           </div>
       </section>
    </div>
    <div class="col-md-12">
        <section class="panel">
           <header class="panel-heading">
               <div class="panel-actions">
                   <a href="#" class="fa fa-caret-down"></a>
               </div>
               <h2 class="panel-title">Service availability</h2>
               <p class="panel-subtitle">See the last time data was retrieved.</p>
           </header>
           <div class="panel-body">
                <ul id="sub-list">
{#                    FOREACH HERE BRAMBY#}
{#                        <li class="list-group-item">#}
{#                            <p><b>[Station]</b> - Last received at: [time]</p>#}
{#                         </li>#}

                 </ul>
           </div>
       </section>
    </div>
</div>
{% endblock %}

